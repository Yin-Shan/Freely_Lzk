import paramiko
import time

err_list = []
done_list=[]
def xx(ip):
    global done_list
    global err_list
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(hostname=ip, port=22, username='cattsoft', password='Cat@1234', timeout=10)
        channel = ssh.invoke_shell()
        resp = channel.recv(65535)
        channel.settimeout(8)
        channel.send("su -\n")
        time.sleep(1)
        while not channel.recv_ready():
            print(ip+" Working...")
        print(ip+" Working...")
        channel.send("Rot@1234\n")
        channel.send("crontab -l |grep -v ntpdate|crontab\n")
        channel.send('(crontab -l;echo "30 5 * * * /usr/sbin/ntpdate 134.127.101.246;/sbin/hwclock -w") | crontab\n')
        buff2=''
        while not buff2.endswith('# '):
            time.sleep(0.2)
            resp = channel.recv(65535)
            try:
                buff2 += resp.decode('utf-8')
            except Exception as b:
                buff2 += resp.decode('gb2312')
            except:
                buff2 += resp.decode('gb18030')
        print(buff2)
        my_file = open('done_list.txt', 'a')
        my_file.write(str(ip+' --Done\n'))
        my_file.close()
        ssh.close()
    except Exception as e:
        print(e)
        print(type(e))
        my_file = open('err_list.txt', 'a') 
        my_file.write(str(ip+' --Error\n'))
        my_file.close()
        ssh.close()

ip_list = [
'172.22.0.151',
'172.22.0.152',
'172.22.0.153',
'172.22.0.154',
'172.22.0.155',
'172.22.0.156',
'172.22.0.157',
'172.22.0.158',
'172.10.0.84',
'172.22.0.184',
'172.22.0.159',
'172.10.0.85',
'172.22.0.185',
'172.22.0.161',
'172.22.0.162',
'172.22.0.163',
'172.22.0.164',
'172.22.0.166',
'172.22.0.167',
'172.22.0.168',
'172.22.0.186',
'172.22.0.187',
'172.22.0.188',
'172.22.0.189',
'172.22.0.190',
'172.22.0.191',
'172.22.0.192',
'172.22.0.193',
'172.22.0.194',
'172.22.0.170',
'172.22.0.171',
'172.22.0.172',
'172.22.0.173',
'172.22.0.174',
'172.22.0.175',
'172.22.0.176',
'172.22.0.177',
'172.22.0.178',
'172.22.0.179',
'172.22.0.180',
'172.22.0.181',
'172.22.0.182',
'172.22.0.183',
'172.22.0.250',
'172.22.0.251',
'172.22.0.195',
'172.22.0.245',
'172.22.2.234',
'172.22.2.235',
'172.22.2.236',
'172.22.2.237',
'172.22.2.238',
'172.22.2.239',
'172.22.2.240',
'172.22.2.241',
'172.22.0.252',
'172.30.2.241',
'172.30.2.242',
'172.30.2.248',
'172.30.2.237',
'172.30.2.238',
'172.30.2.239',
'172.30.2.240',
'172.30.1.3',
'172.30.1.4',
'172.24.1.101',
'172.24.1.102',
'172.24.1.103',
'172.24.1.104',
'172.22.2.102',
'172.22.2.103',
'172.22.2.251',
'172.22.2.98',
'172.22.2.99',
'172.22.2.100',
'172.22.2.101',
'172.30.0.245',
'172.30.0.246',
'172.30.0.247',
'172.30.0.248',
'172.30.0.249',
'172.24.1.107',
'172.24.1.108',
'172.30.0.250',
'172.30.0.251',
'172.22.0.165',
'172.22.0.169',
'172.22.0.253',
'172.24.0.201',
'172.24.0.83',
'172.21.4.1',
'172.21.4.2',
'172.21.4.3',
'172.21.4.4',
'172.21.4.5',
'172.10.0.228',
'172.21.0.56',
'172.21.4.6',
'172.10.0.229',
'172.21.0.57',
'172.21.4.7',
'172.21.4.8',
'172.21.4.9',
'172.21.4.10',
'172.21.4.11',
'172.21.4.12',
'172.21.4.59',
'172.21.4.60',
'172.21.4.61',
'172.21.4.62',
'172.21.4.63',
'172.21.4.64',
'172.21.4.65',
'172.21.4.66',
'172.21.4.67',
'172.21.5.234',
'172.21.5.235',
'172.21.5.236',
'172.20.4.141',
'172.20.4.142',
'172.20.4.143',
'172.20.4.144',
'172.20.4.145',
'172.20.4.146',
'172.20.4.147',
'172.20.4.148',
'172.20.4.149',
'172.20.4.150',
'172.20.4.151',
'172.20.4.152',
'172.20.4.153',
'172.20.4.154',
'172.20.4.155',
'172.20.4.156',
'172.20.4.157',
'172.20.4.158',
'172.20.4.159',
'172.20.4.160',
'172.20.4.161',
'172.20.4.162',
'172.20.4.163',
'172.20.4.164',
'172.20.4.165',
'172.20.4.166',
'172.24.5.99',
'172.24.5.100',
'172.24.5.105',
'172.24.5.106',
'172.24.5.107',
'172.24.5.108',
'172.24.5.109',
'172.24.5.110',
'172.24.5.96',
'172.24.5.97',
'172.24.5.98',
'172.24.5.229',
'172.24.5.111',
'172.24.5.112',
'172.20.8.48',
'172.20.8.49',
'172.20.8.50',
'172.20.8.51',
'172.20.8.52',
'172.20.8.53',
'172.21.2.63',
'172.21.2.64',
'172.21.5.21',
'172.21.5.22',
'172.21.5.23',
'172.21.5.24',
'172.21.5.25',
'172.21.5.26',
'172.21.5.27',
'172.21.5.28',
'172.21.5.29',
'172.21.5.30',
'172.21.5.31',
'172.21.5.32',
'172.21.5.33',
'172.21.5.34',
'172.21.5.35',
'172.21.5.36',
'172.21.5.37',
'172.21.5.38',
'172.21.5.39',
'172.21.5.40',
'172.21.5.41',
'172.21.5.42',
'172.21.5.91',
'172.21.5.92',
'172.21.5.93',
'172.21.5.94',
'172.21.5.95',
'172.21.5.96',
'172.21.5.97',
'172.21.5.98',
'172.21.5.99',
'172.21.5.100',
'172.21.5.171',
'172.21.3.109',
'172.21.3.110',
'172.21.3.111',
'172.21.3.112',
'172.21.3.113',
'172.21.3.114',
'172.21.3.115',
'172.20.9.25',
'172.20.9.26',
'172.20.9.27',
'172.21.12.155',
'172.21.12.159',
'172.21.12.193',
'172.21.12.156',
'172.21.12.157',
'172.21.12.158',
'134.98.3.30',
'134.100.189.55',
'172.22.0.158',
'172.22.0.159',
'134.101.201.48',
'134.101.201.49',
'134.103.71.181',
'134.103.71.183',
'134.98.3.29']

for ip in ip_list:
    xx(ip)
